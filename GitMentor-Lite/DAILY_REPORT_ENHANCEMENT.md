# 日报生成功能增强说明

## 概述

本次更新为 GitMentor 的日报生成功能带来了重大增强，引入了本地缓存机制、更详细的提交分析以及更丰富的报告内容。

## 主要改进

### 1. 本地文件缓存机制

- **缓存策略**：使用仓库路径和提交ID作为唯一标识，为每个提交的分析结果创建独立的缓存文件
- **缓存位置**：`%APPDATA%/.gitmentor/cache/` 目录下
- **性能优化**：已分析的提交会直接从缓存加载，避免重复计算
- **缓存管理**：支持清理过期缓存（通过 `cleanup_cache` 命令）

### 2. 单个提交详细分析

新增的提交分析功能包括：

- **文件变更详情**：记录每个文件的变更类型（新增/修改/删除）、代码行数变化
- **影响级别评估**：自动将提交分为 Critical、High、Medium、Low 四个级别
- **智能标签**：根据提交消息和代码变更自动生成标签（如"新功能"、"缺陷修复"等）
- **提交摘要**：生成简洁的中文描述，概括本次提交的主要改动

### 3. 增强的报告模板

#### 单个提交分析模板
包含提交的完整信息：
- 基本信息（作者、时间、消息）
- 文件变更统计
- 影响级别和标签
- 自动生成的摘要

#### 日报汇总模板
提供更丰富的统计信息：
- 代码变更统计（新增/删除行数）
- 重要提交展示
- 各仓库提交情况
- 贡献者详细统计
- 标签分布统计
- 技术栈分析（基于文件类型）

## 使用方法

### 基础日报生成

1. 选择一个或多个代码仓库
2. 选择要分析的贡献者（可选）
3. 设置日期范围
4. 点击"开始生成"获得基础日报

### 增强版日报生成

1. 完成基础日报生成的步骤 1-3
2. 生成基础日报后，点击"增强版报告"按钮
3. 系统会使用新的分析引擎生成更详细的报告

### 查看和导出报告

- **查看报告**：在新窗口中打开格式化的报告内容
- **导出报告**：将报告保存为 Markdown 文件

## 技术实现

### 后端架构

- **CacheManager**：负责缓存文件的读写和管理
- **TemplateManager**：管理报告模板，支持自定义模板
- **AnalysisEngine**：核心分析引擎，处理提交分析和报告生成
- **新增命令**：
  - `analyze_and_cache_commit`：分析并缓存单个提交
  - `generate_enhanced_daily_report`：生成增强版日报
  - `get_commit_cache_status`：检查缓存状态
  - `cleanup_cache`：清理过期缓存

### 前端改进

- 新增"增强版报告"按钮，使用紫色渐变样式区分
- 改进的报告查看器，支持基本的 Markdown 格式显示
- 报告导出功能，支持下载为 .md 文件

## 数据结构

### 新增类型

```rust
struct CommitDetailAnalysis {
    pub commit_id: String,
    pub repo_path: String,
    pub author: String,
    pub email: String,
    pub timestamp: i64,
    pub message: String,
    pub files_changed: Vec<CommitFileChange>,
    pub insertions: u32,
    pub deletions: u32,
    pub summary: String,
    pub impact_level: ImpactLevel,
    pub tags: Vec<String>,
}

enum ImpactLevel {
    Low,      // 小改动（格式、注释等）
    Medium,   // 一般功能改动
    High,     // 重要功能改动
    Critical, // 核心功能或架构改动
}
```

## 后续优化方向

1. **AI 增强分析**：集成 AI 服务进行更智能的提交内容分析
2. **自定义模板**：允许用户自定义报告模板
3. **定期自动生成**：支持定时自动生成日报
4. **报告分享**：支持将报告分享给团队成员
5. **图表展示**：在报告中添加可视化图表

## 注意事项

1. 首次使用增强版功能时，由于需要分析每个提交，可能会比基础版稍慢
2. 缓存文件会随着使用逐渐增加，建议定期清理
3. 确保有足够的磁盘空间存储缓存文件
4. 增强版功能需要 Tauri 2.x 支持

---

**更新时间**：2025-09-16  
**版本**：v0.2.0+